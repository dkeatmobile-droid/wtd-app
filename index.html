<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#1f7a3a" />
  <title>WTD Tracker</title>

  <!-- If you have a manifest/service worker in your repo, keep these filenames consistent -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <style>
    :root{
      --ok:#1f7a3a;
      --warn:#b26b00;
      --due:#a32121;
      --card:#ffffff;
      --bg:#f4f5f7;
      --text:#111;
      --muted:#666;
      --border:#e6e6e6;
      --shadow: 0 8px 20px rgba(0,0,0,.08);
      --radius: 16px;
    }

    html,body{height:100%; margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); background:var(--bg);}

    /* APP LAYOUT */
    .app{height:100vh; display:flex; flex-direction:column;}
    header.topHeader{
      color:#fff;
      padding: 10px 12px 12px;
      transition: background .2s ease;
    }
    header.compliance-ok{background:var(--ok);}
    header.compliance-warn{background:var(--warn);}
    header.compliance-due{background:var(--due);}

    .headerRow{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .brand .title{font-weight:900; font-size:16px; line-height:1.1;}
    .brand .subtitle{font-size:12px; margin-top:2px; opacity:.95;}

    .rockers{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
    .rocker{display:inline-flex; border-radius:999px; overflow:hidden; border:1px solid rgba(255,255,255,.35); background: rgba(0,0,0,.15);}
    .rockerBtn{
      padding:8px 10px; font-size:12px; border:0; background:transparent; color:#fff;
      cursor:pointer; user-select:none; font-weight:700; opacity:.9;
    }
    .rockerBtn.isOn{background: rgba(255,255,255,.25); opacity:1;}

    .headerStats{margin-top:10px; display:grid; grid-template-columns:repeat(3,1fr); gap:8px;}
    .stat{background: rgba(0,0,0,.16); border-radius: 12px; padding: 8px 10px;}
    .stat .label{font-size:11px; opacity:.95;}
    .stat .value{font-size:14px; font-weight:900; margin-top:2px;}

    main.main{flex:1; min-height:0;}
    section.panel{height:100%; box-sizing:border-box; padding:10px 12px;}
    section.panelFull{overflow:auto;}
    section.panelBasic{
      overflow:hidden; /* BASIC: no scrolling */
      display:grid;
      grid-template-rows: auto auto 1fr auto;
      gap:10px;
    }
    .isHidden{display:none !important;}

    /* UI ELEMENTS */
    .controlsRow{display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;}
    .btn{
      padding:12px 10px; border-radius: 14px; border:1px solid var(--border);
      background:#fff; font-weight:900; cursor:pointer; box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    .btn:active{transform: translateY(1px);}
    .btn.primary{border-color:#111;}
    .btn.danger{border-color:#b00020; color:#b00020;}
    .btn.ghost{background: transparent;}

    .bigActions{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
    .btn.big{padding: 18px 10px; font-size:18px; border-radius: 18px; box-shadow: var(--shadow);}
    .btn.big.isActive{outline: 3px solid rgba(0,0,0,.12);}

    .miniGrid{display:grid; grid-template-columns: 1fr 1fr; gap:10px; align-content:start;}
    .card{
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding: 10px;
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
    }
    .card .label{font-size:12px; color:var(--muted);}
    .card .metric{font-size:20px; font-weight:1000; margin-top:6px;}

    .hint{font-size:12px; color:rgba(0,0,0,.6);}
    .subtle{font-size:12px; color: var(--muted);}

    /* FULL MODE */
    h3{margin: 14px 0 8px; font-size: 14px;}
    .row{display:flex; gap:10px; flex-wrap:wrap;}
    .field{
      flex:1;
      background:#fff; border:1px solid var(--border); border-radius: 14px; padding:10px;
    }
    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px; font-weight:700;}
    input, select{
      width:100%; box-sizing:border-box;
      padding:10px; border-radius: 12px; border:1px solid var(--border);
      font-size:14px; background:#fff;
    }
    .logList{display:flex; flex-direction:column; gap:8px; margin-top:8px;}
    .logItem{background:#fff; border:1px solid var(--border); border-radius: 14px; padding:10px;}
    .logItem .top{display:flex; justify-content:space-between; gap:10px; align-items:baseline;}
    .pill{
      display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:900;
      border:1px solid var(--border); background:#fafafa;
    }
    .pill.work{background:#eef6ff; border-color:#cfe6ff;}
    .pill.break{background:#fff5e8; border-color:#ffe1b7;}
    .pill.qual{background:#e9fff0; border-color:#bff0cd;}

    /* OVERLAY ALERT */
    .overlay{
      position:fixed; inset:0; display:none; align-items:flex-end; justify-content:center;
      background: rgba(0,0,0,.35); padding: 16px;
    }
    .overlay.show{display:flex;}
    .sheet{
      width:min(520px, 100%);
      background:#fff; border-radius: 22px; padding: 14px; box-shadow: var(--shadow);
    }
    .sheet h2{margin:0; font-size:16px;}
    .sheet p{margin:8px 0 12px; color:#333; font-size:14px;}
    .sheet .actions{display:flex; gap:10px;}
    .sheet .actions .btn{flex:1;}

    @media (max-height: 700px){
      .btn.big{padding:14px 10px; font-size:16px;}
      .card .metric{font-size:18px;}
      .headerStats{gap:6px;}
      .stat{padding:6px 8px;}
    }
  </style>
</head>

<body>
<div class="app">

  <!-- HEADER -->
  <header id="topHeader" class="topHeader compliance-ok">
    <div class="headerRow">
      <div class="brand">
        <div class="title">WTD Tracker</div>
        <div id="headerStatus" class="subtitle">Ready</div>
      </div>

      <div class="rockers">
        <!-- Basic / Full -->
        <div class="rocker" role="group" aria-label="View mode">
          <button id="btnViewBasic" class="rockerBtn isOn" type="button">Basic</button>
          <button id="btnViewFull" class="rockerBtn" type="button">Full</button>
        </div>

        <!-- 13h / 15h -->
        <div class="rocker" role="group" aria-label="Shift length">
          <button id="btnShift13" class="rockerBtn isOn" type="button">13h</button>
          <button id="btnShift15" class="rockerBtn" type="button">15h</button>
        </div>
      </div>
    </div>

    <div class="headerStats">
      <div class="stat">
        <div class="label">Start</div>
        <div id="hdrStart" class="value">—</div>
      </div>
      <div class="stat">
        <div class="label">Duration</div>
        <div id="hdrDuration" class="value">00:00</div>
      </div>
      <div class="stat">
        <div class="label">Finish by</div>
        <div id="hdrFinishBy" class="value">—</div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="main">

    <!-- BASIC (no scrolling) -->
    <section id="panelBasic" class="panel panelBasic">
      <div class="controlsRow">
        <button id="btnStartShift" class="btn primary" type="button">Start shift</button>
        <button id="btnEndShift" class="btn" type="button">End shift</button>
        <button id="btnResetDay" class="btn danger" type="button">Reset day</button>
      </div>

      <div class="bigActions">
        <button id="btnWork" class="btn big" type="button">Work</button>
        <button id="btnBreak" class="btn big" type="button">Break</button>
      </div>

      <div class="miniGrid">
        <div class="card">
          <div class="label">Shift time</div>
          <div id="uiShiftTime" class="metric">00:00</div>
        </div>
        <div class="card">
          <div class="label">Continuous work</div>
          <div id="uiContinuous" class="metric">00:00</div>
        </div>
        <div class="card">
          <div class="label">Next break in</div>
          <div id="uiNextBreakIn" class="metric">—</div>
        </div>
        <div class="card">
          <div class="label">Break still needed</div>
          <div id="uiBreakNeeded" class="metric">00:00</div>
        </div>
      </div>

      <div class="hint">Qualifying break = BREAK for ≥ 15 minutes.</div>
    </section>

    <!-- FULL (scrollable) -->
    <section id="panelFull" class="panel panelFull isHidden">

      <h3>Quick summary</h3>
      <div class="miniGrid">
        <div class="card">
          <div class="label">Total work</div>
          <div id="uiWorkTotal_full" class="metric">00:00</div>
        </div>
        <div class="card">
          <div class="label">Qualifying breaks</div>
          <div id="uiQualBreak_full" class="metric">00:00</div>
        </div>
        <div class="card">
          <div class="label">Break required</div>
          <div id="uiBreakReq_full" class="metric">00:00</div>
        </div>
        <div class="card">
          <div class="label">Break still needed</div>
          <div id="uiBreakNeed_full" class="metric">00:00</div>
        </div>
      </div>

      <h3>Manual add segment</h3>
      <div class="row">
        <div class="field" style="min-width:140px;">
          <label for="manType">Type</label>
          <select id="manType">
            <option value="WORK">WORK</option>
            <option value="BREAK">BREAK</option>
          </select>
        </div>
        <div class="field">
          <label for="manStart">Start (HH:MM)</label>
          <input id="manStart" inputmode="numeric" placeholder="08:00" />
        </div>
        <div class="field">
          <label for="manEnd">End (HH:MM)</label>
          <input id="manEnd" inputmode="numeric" placeholder="09:15" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button id="btnAddManual" class="btn primary" type="button">Add segment</button>
        <button id="btnDeleteLast" class="btn" type="button">Delete last</button>
      </div>
      <div class="subtle" style="margin-top:6px;">
        Times are added on today’s date. If end is earlier than start, it will be treated as next day.
      </div>

      <h3>Segment log</h3>
      <div id="logList" class="logList"></div>

      <div style="height:10px;"></div>
    </section>

  </main>
</div>

<!-- OVERLAY -->
<div id="overlay" class="overlay" aria-hidden="true">
  <div class="sheet">
    <h2 id="ovTitle">Break due</h2>
    <p id="ovText">You have reached 6 hours continuous work. Start a break now.</p>
    <div class="actions">
      <button id="ovBreak" class="btn primary" type="button">Start break</button>
      <button id="ovDismiss" class="btn" type="button">Dismiss</button>
    </div>
  </div>
</div>

<script>
(() => {
  // -------------------------
  // STORAGE
  // -------------------------
  const STORAGE_KEY = "wtd_app_v2_state";

  const defaultState = () => ({
    view: "basic",            // "basic" | "full"
    shiftHours: 13,           // 13 or 15
    shiftStartMs: null,       // number | null
    currentType: null,        // "WORK" | "BREAK" | null
    currentStartMs: null,     // number | null
    segments: [],             // [{type, startMs, endMs|null}]
    overlayDismissedAtMs: null
  });

  let state = loadState();

  function loadState(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return defaultState();
      const s = JSON.parse(raw);
      return { ...defaultState(), ...s };
    } catch {
      return defaultState();
    }
  }
  function saveState(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  // -------------------------
  // DOM
  // -------------------------
  const topHeader = document.getElementById("topHeader");
  const headerStatus = document.getElementById("headerStatus");
  const hdrStart = document.getElementById("hdrStart");
  const hdrDuration = document.getElementById("hdrDuration");
  const hdrFinishBy = document.getElementById("hdrFinishBy");

  const panelBasic = document.getElementById("panelBasic");
  const panelFull  = document.getElementById("panelFull");

  const btnViewBasic = document.getElementById("btnViewBasic");
  const btnViewFull  = document.getElementById("btnViewFull");

  const btnShift13 = document.getElementById("btnShift13");
  const btnShift15 = document.getElementById("btnShift15");

  const btnStartShift = document.getElementById("btnStartShift");
  const btnEndShift = document.getElementById("btnEndShift");
  const btnResetDay = document.getElementById("btnResetDay");
  const btnWork = document.getElementById("btnWork");
  const btnBreak = document.getElementById("btnBreak");

  const uiShiftTime = document.getElementById("uiShiftTime");
  const uiContinuous = document.getElementById("uiContinuous");
  const uiNextBreakIn = document.getElementById("uiNextBreakIn");
  const uiBreakNeeded = document.getElementById("uiBreakNeeded");

  const uiWorkTotal_full = document.getElementById("uiWorkTotal_full");
  const uiQualBreak_full = document.getElementById("uiQualBreak_full");
  const uiBreakReq_full  = document.getElementById("uiBreakReq_full");
  const uiBreakNeed_full = document.getElementById("uiBreakNeed_full");

  const manType = document.getElementById("manType");
  const manStart = document.getElementById("manStart");
  const manEnd = document.getElementById("manEnd");
  const btnAddManual = document.getElementById("btnAddManual");
  const btnDeleteLast = document.getElementById("btnDeleteLast");

  const logList = document.getElementById("logList");

  const overlay = document.getElementById("overlay");
  const ovTitle = document.getElementById("ovTitle");
  const ovText = document.getElementById("ovText");
  const ovBreak = document.getElementById("ovBreak");
  const ovDismiss = document.getElementById("ovDismiss");

  // -------------------------
  // HELPERS
  // -------------------------
  const MIN = 60000;
  const HOUR = 60 * MIN;

  function pad2(n){ return String(n).padStart(2,"0"); }

  function fmtHHMM(ms){
    const d = new Date(ms);
    return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
  }

  function fmtDur(ms){
    const totalMin = Math.max(0, Math.floor(ms / MIN));
    const hh = Math.floor(totalMin / 60);
    const mm = totalMin % 60;
    return `${pad2(hh)}:${pad2(mm)}`;
  }

  function clamp0(ms){ return Math.max(0, ms); }

  function setView(view){
    state.view = view;
    panelBasic.classList.toggle("isHidden", view !== "basic");
    panelFull.classList.toggle("isHidden", view !== "full");
    btnViewBasic.classList.toggle("isOn", view === "basic");
    btnViewFull.classList.toggle("isOn", view === "full");
    saveState();
  }

  function setShiftHours(h){
    state.shiftHours = h;
    btnShift13.classList.toggle("isOn", h === 13);
    btnShift15.classList.toggle("isOn", h === 15);
    saveState();
    render(); // finish-by recalculates instantly
  }

  function setCompliance(level, text){
    topHeader.classList.remove("compliance-ok","compliance-warn","compliance-due");
    topHeader.classList.add(level === "due" ? "compliance-due" : level === "warn" ? "compliance-warn" : "compliance-ok");
    headerStatus.textContent = text;

    // theme-color update to match header
    const theme = document.querySelector('meta[name="theme-color"]');
    if(theme){
      theme.setAttribute("content", level === "due" ? "#a32121" : level === "warn" ? "#b26b00" : "#1f7a3a");
    }
  }

  function isShiftRunning(){
    return !!state.shiftStartMs;
  }

  function closeCurrentSegment(nowMs){
    if(state.currentType && state.currentStartMs){
      const last = state.segments[state.segments.length - 1];
      if(last && last.endMs == null){
        last.endMs = nowMs;
      }
    }
    state.currentType = null;
    state.currentStartMs = null;
  }

  function startSegment(type){
    if(!isShiftRunning()) return;
    const now = Date.now();
    // close previous if open
    const last = state.segments[state.segments.length - 1];
    if(last && last.endMs == null){
      if(last.type === type) return; // already in that mode
      last.endMs = now;
    }

    // start new
    state.currentType = type;
    state.currentStartMs = now;
    state.segments.push({ type, startMs: now, endMs: null });
    saveState();
    render();
  }

  function startShift(){
    if(isShiftRunning()) return;
    const now = Date.now();
    state.shiftStartMs = now;
    state.currentType = null;
    state.currentStartMs = null;
    state.segments = [];
    state.overlayDismissedAtMs = null;
    saveState();
    render();
  }

  function endShift(){
    if(!isShiftRunning()) return;
    closeCurrentSegment(Date.now());
    // keep shiftStartMs so user can still view totals until Reset day
    // If you prefer, uncomment next line to fully end and freeze:
    // state.shiftStartMs = null;
    saveState();
    render();
  }

  function resetDay(){
    state = defaultState();
    saveState();
    render();
  }

  function parseTimeToMs(hhmm){
    // Returns ms for "today" at hh:mm, local time.
    const m = /^(\d{1,2}):(\d{2})$/.exec((hhmm||"").trim());
    if(!m) return null;
    const hh = Number(m[1]), mm = Number(m[2]);
    if(hh < 0 || hh > 23 || mm < 0 || mm > 59) return null;
    const d = new Date();
    d.setHours(hh, mm, 0, 0);
    return d.getTime();
  }

  function addManualSegment(){
    const type = manType.value;
    const s = parseTimeToMs(manStart.value);
    const e0 = parseTimeToMs(manEnd.value);
    if(s == null || e0 == null){
      alert("Please enter valid times like 08:00");
      return;
    }
    let e = e0;
    if(e <= s) e = e + 24 * HOUR; // treat as next day
    state.segments.push({ type, startMs: s, endMs: e });
    saveState();
    render();
  }

  function deleteLast(){
    if(state.segments.length === 0) return;
    // if last is open, just close it and remove
    const last = state.segments[state.segments.length - 1];
    state.segments.pop();
    if(last && last.endMs == null){
      state.currentType = null;
      state.currentStartMs = null;
    }
    saveState();
    render();
  }

  // -------------------------
  // METRICS
  // -------------------------
  function getSegmentsResolved(now){
    return state.segments.map(seg => ({
      ...seg,
      endMs: seg.endMs == null ? now : seg.endMs
    }));
  }

  function sumDurationMs(segments, type){
    return segments
      .filter(s => s.type === type)
      .reduce((acc, s) => acc + clamp0(s.endMs - s.startMs), 0);
  }

  function qualifyingBreakMs(segments){
    return segments
      .filter(s => s.type === "BREAK")
      .reduce((acc, s) => {
        const dur = clamp0(s.endMs - s.startMs);
        return acc + (dur >= 15 * MIN ? dur : 0);
      }, 0);
  }

  function requiredBreakMs(workMs){
    // Simple rule set: >6h => 30m, >9h => 45m
    if(workMs > 9 * HOUR) return 45 * MIN;
    if(workMs > 6 * HOUR) return 30 * MIN;
    return 0;
  }

  function continuousWorkSinceLastQualBreakMs(segments){
    // counts WORK time after the most recent qualifying BREAK ended.
    // If currently in BREAK (even not-qual), continuous work stops increasing after work ended.
    // We find last qualifying break end, then sum WORK segments after that end.
    let lastQualEnd = null;
    for(const s of segments){
      if(s.type === "BREAK"){
        const dur = clamp0(s.endMs - s.startMs);
        if(dur >= 15 * MIN){
          lastQualEnd = s.endMs;
        }
      }
    }
    if(lastQualEnd == null){
      // no qualifying breaks yet: sum all work
      return sumDurationMs(segments, "WORK");
    }
    return segments
      .filter(s => s.type === "WORK" && s.endMs > lastQualEnd)
      .reduce((acc, s) => {
        const start = Math.max(s.startMs, lastQualEnd);
        return acc + clamp0(s.endMs - start);
      }, 0);
  }

  function nextBreakDueInMs(continuousWorkMs){
    // WTD: break required after 6h continuous work
    return 6 * HOUR - continuousWorkMs;
  }

  // -------------------------
  // OVERLAY
  // -------------------------
  function showOverlay(title, text){
    ovTitle.textContent = title;
    ovText.textContent = text;
    overlay.classList.add("show");
    overlay.setAttribute("aria-hidden", "false");
  }

  function hideOverlay(){
    overlay.classList.remove("show");
    overlay.setAttribute("aria-hidden", "true");
  }

  ovBreak.addEventListener("click", () => {
    hideOverlay();
    startSegment("BREAK");
  });

  ovDismiss.addEventListener("click", () => {
    state.overlayDismissedAtMs = Date.now();
    saveState();
    hideOverlay();
  });

  // -------------------------
  // RENDER
  // -------------------------
  function render(){
    const now = Date.now();

    // view + shift hours toggles
    setView(state.view);
    setShiftHours(state.shiftHours);

    // header times
    if(!state.shiftStartMs){
      hdrStart.textContent = "—";
      hdrDuration.textContent = "00:00";
      hdrFinishBy.textContent = "—";
    } else {
      hdrStart.textContent = fmtHHMM(state.shiftStartMs);
      hdrDuration.textContent = fmtDur(now - state.shiftStartMs);
      hdrFinishBy.textContent = fmtHHMM(state.shiftStartMs + state.shiftHours * HOUR);
    }

    // button active state
    btnWork.classList.toggle("isActive", state.currentType === "WORK");
    btnBreak.classList.toggle("isActive", state.currentType === "BREAK");

    // metrics
    const segs = getSegmentsResolved(now);
    const workMs = sumDurationMs(segs, "WORK");
    const qualMs = qualifyingBreakMs(segs);
    const reqMs = requiredBreakMs(workMs);
    const needMs = clamp0(reqMs - qualMs);

    const continuousMs = continuousWorkSinceLastQualBreakMs(segs);
    const dueInMs = nextBreakDueInMs(continuousMs);

    // basic UI
    uiShiftTime.textContent = state.shiftStartMs ? fmtDur(now - state.shiftStartMs) : "00:00";
    uiContinuous.textContent = fmtDur(continuousMs);
    uiBreakNeeded.textContent = fmtDur(needMs);

    if(!state.shiftStartMs){
      uiNextBreakIn.textContent = "—";
    } else if(dueInMs <= 0){
      uiNextBreakIn.textContent = "DUE";
    } else {
      uiNextBreakIn.textContent = fmtDur(dueInMs);
    }

    // full UI
    uiWorkTotal_full.textContent = fmtDur(workMs);
    uiQualBreak_full.textContent = fmtDur(qualMs);
    uiBreakReq_full.textContent = fmtDur(reqMs);
    uiBreakNeed_full.textContent = fmtDur(needMs);

    // log
    renderLog(segs);

    // compliance + header color + overlay
    if(!state.shiftStartMs){
      setCompliance("ok", "Ready");
      hideOverlay();
      return;
    }

    const warnThreshold = 15 * MIN;
    if(dueInMs <= 0){
      setCompliance("due", "Break due now");
      // show overlay unless dismissed recently (10 mins)
      const dismissedRecently = state.overlayDismissedAtMs && (now - state.overlayDismissedAtMs) < 10 * MIN;
      if(!dismissedRecently && !overlay.classList.contains("show")){
        showOverlay("Break due", "You have reached 6 hours continuous work. Start a break now.");
      }
    } else if(dueInMs <= warnThreshold){
      setCompliance("warn", `Break due in ${fmtDur(dueInMs)}`);
      hideOverlay();
    } else {
      setCompliance("ok", `Next break in ${fmtDur(dueInMs)}`);
      hideOverlay();
    }
  }

  function renderLog(segs){
    if(!logList) return;
    if(segs.length === 0){
      logList.innerHTML = `<div class="subtle">No segments yet.</div>`;
      return;
    }

    // newest first
    const items = [...segs].sort((a,b) => b.startMs - a.startMs);

    logList.innerHTML = items.map(s => {
      const dur = clamp0(s.endMs - s.startMs);
      const isQual = s.type === "BREAK" && dur >= 15 * MIN;
      const pillClass = s.type === "WORK" ? "work" : "break";
      const qualPill = isQual ? `<span class="pill qual">QUAL</span>` : "";
      return `
        <div class="logItem">
          <div class="top">
            <div>
              <span class="pill ${pillClass}">${s.type}</span>
              ${qualPill}
            </div>
            <div class="subtle">${fmtDur(dur)}</div>
          </div>
          <div class="subtle" style="margin-top:6px;">
            ${fmtHHMM(s.startMs)} → ${fmtHHMM(s.endMs)}
          </div>
        </div>
      `;
    }).join("");
  }

  // -------------------------
  // EVENTS
  // -------------------------
  btnViewBasic.addEventListener("click", () => setView("basic"));
  btnViewFull.addEventListener("click", () => setView("full"));

  btnShift13.addEventListener("click", () => setShiftHours(13));
  btnShift15.addEventListener("click", () => setShiftHours(15));

  btnStartShift.addEventListener("click", () => startShift());
  btnEndShift.addEventListener("click", () => endShift());
  btnResetDay.addEventListener("click", () => {
    const ok = confirm("Reset day? This clears the shift and all segments.");
    if(ok) resetDay();
  });

  btnWork.addEventListener("click", () => startSegment("WORK"));
  btnBreak.addEventListener("click", () => startSegment("BREAK"));

  btnAddManual.addEventListener("click", addManualSegment);
  btnDeleteLast.addEventListener("click", deleteLast);

  // -------------------------
  // TICKER
  // -------------------------
  setInterval(render, 1000);

  // -------------------------
  // PWA: service worker (optional)
  // -------------------------
  // Make sure you have a file named "sw.js" at the site root if you want this.
  if("serviceWorker" in navigator){
    navigator.serviceWorker.register("./sw.js").catch(() => {});
  }

  // initial render
  // restore toggles without recursion (setView/setShiftHours save+render)
  // We call render once; UI setters will align state.
  render();

})();
</script>
</body>
</html>
